---
title: "Bats-DataManip"
author: "Shelby Cline"
date: '2022-06-27'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(lubridate)
library(readxl)

bats <- readRDS('bats.RData')

bats <- bats %>% 
  mutate(year = year(DATE), 
         monthN = month(DATE),
         month = month.abb[monthN],
         hour = hour(TIME),
         sensor = paste(COMPARTMENT,SITE, sep='_') ) %>% 
  filter( AUTO.ID != 'Noise' )

# Any bat listed as CORROW should be listed as the secondary species
bats <- bats %>% 
  mutate( AUTO.ID = gsub("CORROW", 
                         unlist(strsplit(ALTERNATES, split=';', fixed=TRUE))[1],
                         AUTO.ID) )
```


```{r}
# species call counts by year -----
No.ID <- c('NoId', 'NoID', 'Noise')
bats.time <- bats %>% 
  filter(! AUTO.ID %in% No.ID, year < 2022) %>% 
  group_by(year, AUTO.ID) %>%
  tally()

ggplot(data=bats.time, aes(x=year, y=n, color=AUTO.ID) )+
  geom_line()+
  labs(title = 'Number of Total Calls Per Species', 
       subtitle = "From 2017-2021", 
       x = 'Year', y = 'Number of Calls')
```

```{r}
# my goal is to group everything and then use summarize so that I can have the total frequency of the bats by species across months.
freq_by_month <- bats %>% 
  
  group_by(year, monthN, AUTO.ID) %>% 
  filter(! AUTO.ID %in% No.ID) %>% 
  summarize(frequencies = n())


# With the graph, I want to filter to keep only specific year and species combinations for clarity, and I want months to be on the x-axis and the number of calls recorded on the y. 
chosen_species <- levels(factor(freq_by_month$AUTO.ID))

ggplot(data = freq_by_month %>% filter(AUTO.ID %in% chosen_species, year == 2017),
       aes(x = monthN,
           y = frequencies,
           color = AUTO.ID))+
  geom_line() 










``` 



