---
title: "Bats: Long-Term Trends"
author: "Shelby Cline, Hallie Rutten, Monae Scott"
date: '2022-06-27'
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

source('dataRead.R')
```

# Long-Term (yearly) and Climate (temperature/weather) Trends

```{r}
# my goal is to group everything and then use summarize so that I can have the total frequency of the bats by species across months.
freq_by_month <- bats %>%
  group_by(year, monthN, AUTO.ID) %>%
  filter(! AUTO.ID %in% No.ID) %>%
  summarize(frequencies = n())
# With the graph, I want to filter to keep only specific year and species combinations for clarity, and I want months to be on the x-axis and the number of calls recorded on the y.
chosen_species <- levels(factor(freq_by_month$AUTO.ID))
ggplot(data = freq_by_month %>% filter(AUTO.ID %in% chosen_species, year == 2017),
       aes(x = monthN,
           y = frequencies,
           color = AUTO.ID))+
  geom_line()+
  labs(title = 'Frequencies by Month',
       subtitle = 'During 2017',
       x = 'Month by Number',
       y = 'Number of Calls')
  
# here i just wanted to look at the total number of recordings across all species

bats %>%
  group_by(AUTO.ID) %>%
  tally()
```

```{r}
# account for number of sensors active on each date -----
bats.daily <- bats %>%
  group_by(DATE) %>%
  mutate( nSensors = length(unique(sensor)) )
bats.daily <- bats.daily %>%
   filter(! AUTO.ID %in% No.ID) %>%
  group_by(DATE,AUTO.ID) %>%
  summarize( count = n(),
             relFreq = count/nSensors )
bats.daily <- distinct(bats.daily)
chosen_species <- levels(factor(bats.daily$AUTO.ID))
# wanting to graph just to see what they all look like over time
ggplot(data = bats.daily %>% filter(AUTO.ID %in% chosen_species)) +
         geom_line(aes( x = DATE,
                 y = count,
                 color = AUTO.ID,
                 alpha = 0.7))
# now i would like to look at just MYOTIS species
ggplot(data = bats.daily %>% filter(AUTO.ID == 'MYOLUC'))+
  geom_line(aes(x = DATE,
                 y = count),
            color = 'blue') +
  labs(title = 'Little Brown Bat Frequencies',
       subtitle = 'Across all Available Years',
       x = 'Year',
       y = 'Frequency')
```

```{r}
# the goal here was to create a data frame containing the amount of frequencies recorded of a specific species at a specific sensor
selected_year <- 2017
bats.ym <- bats %>%
  group_by(year, month, AUTO.ID, sensor) %>%
  tally()
# then we graphed it and facet-wrapped by sensor to look into each individual one with available data
ggplot(data = bats.ym %>% filter(year == selected_year),
       aes(x = month,
           y = n,
          fill = AUTO.ID))+
  geom_col(position = "dodge")+
  facet_wrap(~sensor)
```

```{r}
# want to create a column of cave obligates versus non-cave obligates to observe their activity
cave_obligate = c('PERSUB', 'MYOLEI', 'MYOAUS', 'MYOLUC', 'MYOSOD', 'MYOGRI', 'MYOSEP')
non_cave_obligate = c('LASBOR', 'NYCHUM', 'EPTFUS', 'LASNOC', 'LASCIN', 'CORRAF')
test <- bats %>%
  mutate(`cave obligate?` = ! AUTO.ID %in% non_cave_obligate) %>%
  group_by(monthN, `cave obligate?`, year) %>%
  filter(monthN == 12) %>%
  tally()
ggplot(data = test,
       aes(x = year,
           y = n,
           color = `cave obligate?`))+
  geom_line()
# theres a sharp dip in frequencies of both bats in 2020. interesting.
```



```{r}
# simple graph of overall amount of recorded calls to start the day

 overall_bats <- bats %>%
 group_by(AUTO.ID) %>%
  tally()


# this is an actual plot for the overall calls
ggplot(data = overall_bats)+
  geom_col(aes(x = AUTO.ID,
               y = n))+
  labs(title = 'Total Recordings by Species',
       x = 'Species',
       y = 'Number of Calls')+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  scale_y_continuous(labels = comma)

```

```{r}
# my goal here is to try and understand trends between EPTFUS and MYOLUC, maybe a cute lil facet wrap for sensors so that I can see if any of them are/were in the same place. anyways

big_v_lil <- bats %>% 
  group_by(AUTO.ID, sensor, DATE) %>% 
  filter(AUTO.ID %in% c('MYOLUC','EPTFUS')) %>% 
  tally()

ggplot(data = big_v_lil)+
  geom_line(aes(x = DATE,
                y = n,
                color = AUTO.ID))+
  labs(title = 'EPTFUS vs. MYOLUC Presence',
       x = 'Date',
       y = 'Number of Recordings')+
  facet_wrap(~sensor)

# taking a closer look at one of the censors with a lot of activity
ggplot(data = big_v_lil %>% filter(sensor == "C22_S9"))+
  geom_line(aes(x = DATE,
                y = n,
                color = AUTO.ID))+
  labs(title = 'EPTFUS vs. MYOLUC Presence',
       x = 'Date',
       y = 'Number of Recordings')

# i would love if we put this on the dashboard, if you could choose which sensor graph youre looking at

```



```{r}

# How have the MYOTIS species fluctuated over time?

myotis <- bats %>% 
  group_by(AUTO.ID, sensor, DATE, monthN) %>% 
  filter(AUTO.ID %in% c("MYOLUC","MYOLEI", "MYOSOD", "MYOAUS", "MYOSEP", "MYOGRI")) %>% 
  tally()

ggplot(data = myotis)+
  geom_line(aes(x = DATE,
                y = n,
                color = AUTO.ID))+
  labs(title = 'MYOTIS Species Over Time',
       x = 'Time',
       y = 'Number of Recordings')+
  facet_wrap(~AUTO.ID)


```

